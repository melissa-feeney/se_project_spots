(self.webpackJsonp_N_E=self.webpackJsonp_N_E||[]).push([[14],{jJpL:function(e,n,t){"use strict";var s=t("ct0k"),a=t("tZIg"),i=t("vwgk"),r=t("/Tn5"),o=t("8yKA"),l=t("m/u1"),d=t("XmMX"),c=t("VwQa"),u=t("gvy1"),g={byId:i.c,ids:a.a,loadingIds:a.a,errors:i.c,isCreatingRoom:!1},f="https://chat-server-cluster.production.groovehq.com".replace(/https?:\/\//g,""),v={};function b(e,n){var t=e.roomId,s=Object(d.a)(Object(o.k)(n)),a=Object(u.d)(e,s),i=Object(l.a)(n),r=Object(u.i)(e).map((function(e){return Object(u.b)(e,i,f)})),c=Object(u.f)(e,r),g=Object(u.e)(e),v=Object(u.g)(e),b=Object(u.h)(e),p=Object(u.m)(e),m=Object(u.k)(e),y=Object(u.n)(e);return{id:t,assignedAgentId:a,lastActivityAt:b,lastMessage:Object(u.c)(v,a,s),agentIds:r,type:p,createdAt:m,state:y,hasParticipatingUsersSeenLastMessage:c,hasEnduserSeenLastMessage:g}}function p(e,n){var t=n.id;e.byId[t]?Object.assign(e.byId[t],n):e.byId[t]=n}function m(e){return e.isCreatingRoom=!1,e}v[c.o]=function(e){return e.loadingIds.includes("*")||e.loadingIds.push("*"),e.errors["*"]&&(e.errors["*"]=null),e},v[c.p]=function(e,n){var t=n.payload.rawData.rooms,s=n.globalState;return t.forEach((function(n){var t=n.roomId;Object(u.o)(n)&&(p(e,b(n,s)),e.ids.includes(t)||e.ids.push(t))})),e.ids.includes("*")||e.ids.push("*"),e.loadingIds.includes("*")&&(e.loadingIds=e.loadingIds.filter((function(e){return"*"!==e}))),e},v[c.n]=function(e,n){var t=n.payload.error;return e.loadingIds.includes("*")&&(e.loadingIds=e.loadingIds.filter((function(e){return"*"!==e}))),e.errors["*"]=t,e},v[c.h]=function(e,n){var t=n.payload.id;return e.loadingIds.includes(t)||e.loadingIds.push(t),e.errors[t]&&(e.errors[t]=null),e},v[c.i]=function(e,n){var t=n.payload.rawData,s=n.meta.requestParameters.id,a=n.globalState;return t&&p(e,b(t,a)),e.ids.includes(s)||e.ids.push(s),e.loadingIds.includes(s)&&(e.loadingIds=e.loadingIds.filter((function(e){return e!==s}))),e},v[c.j]=function(e,n){var t=n.payload.id;return e.byId[t]&&(e.byId[t].hasParticipatingUsersSeenLastMessage=!1),e},v[c.g]=function(e,n){var t=n.payload.error,s=n.meta.requestParameters.id;return e.loadingIds.includes(s)&&(e.loadingIds=e.loadingIds.filter((function(e){return e!==s}))),e.errors[s]=t,e},v[c.l]=function(e){return e.isCreatingRoom=!0,e},v[c.m]=m,v[c.k]=m;var y=Object(r.a)(v,g),j=t("QUNv"),O=t("JdMD"),w=t("nWXf"),k={byId:i.c,lastPresenceTsByUserId:i.c,ids:a.a,agentsOnline:!1},h={};function I(e,n,t){var s,a=n.userId,i=Object(d.a)(Object(l.p)(t)),r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,s={};if(n.membership){var a=n.userId,i=n.name,r=n.rawDisplayName,o=n.user,l=o.displayName,d=o.presence,c=o.avatarUrl,u=n.events.member,g=u&&u.getContent()||{},f=g.displayname,v=g.avatar_url;Object.assign(s,{id:a,name:Object(w.c)(i||r||l||f,t),presence:Object(w.a)(d),avatarUrl:Object(w.b)(c||v)})}else{var b=n.userId,p=n.displayName,m=n.presence,y=n.avatarUrl;Object.assign(s,{id:b,name:Object(w.c)(p,t),presence:Object(w.a)(m),avatarUrl:Object(w.b)(y),type:Object(w.d)(b)})}return"Agent"!==e.name&&"Agent"===s.name&&(s.name=e.name),e.avatarUrl&&!s.avatarUrl&&(s.avatarUrl=e.avatarUrl),s}(e.byId[a],n,i),o=(s=n)instanceof j.RoomMember?s.user.lastPresenceTs:s.lastPresenceTs;e.byId[a]?Object.assign(e.byId[a],r):e.byId[a]=r,e.lastPresenceTsByUserId[a]=o,e.ids.includes(a)||e.ids.push(a)}h[c.p]=function(e,n){var t=n.payload.rawData.rooms,s=n.globalState;return t.forEach((function(n){n.currentState.getMembers().filter((function(e){return!!e.user})).forEach((function(n){I(e,n,s)}))})),e},h[c.f]=function(e,n){var t=n.payload,s=n.globalState;return t.currentState.getMembers().filter((function(e){return!!e.user})).forEach((function(n){I(e,n,s)})),e},h[c.s]=function(e,n){var t=n.payload.rawData.agents,s=n.globalState;t.forEach((function(n){I(e,n,s)}))},h[O.d]=function(e,n){var t=n.payload,s=(t=void 0===t?{}:t).rawData,a=(s=void 0===s?{}:s).widget,i=(a=void 0===a?{}:a).agentsOnline,r=void 0!==i&&i;return e.agentsOnline=r,e};var M=Object(r.a)(h,k),A={};A[c.c]=function(e){return e.isLoading=!0,e.isError=!1,e.isLoaded=!1,e.error=null,e},A[c.d]=function(e,n){var t=n.payload.rawData.chatConfig.agentIds;return e.data=t,e.isLoaded=!0,e.isLoading=!1,e},A[c.b]=function(e,n){var t=n.payload.error;return e.isLoading=!1,e.isError=!0,e.error=t,e},A[c.p]=function(e,n){return n.payload.rawData.rooms.forEach((function(n){n.currentState.getMembers().filter((function(e){return!!e.user})).forEach((function(n){var t=n.user;Object(w.e)(t.userId)&&!e.data.includes(t.userId)&&e.data.push(t.userId)}))})),e},A[c.f]=function(e,n){return n.payload.currentState.getMembers().filter((function(e){return!!e.user})).forEach((function(n){var t=n.user;Object(w.e)(t.userId)&&!e.data.includes(t.userId)&&e.data.push(t.userId)})),e};var E,C=Object(r.a)(A,{isLoading:!1,isLoaded:!1,isError:!1,data:[]}),S=t("m6w3"),_=t("kWlv"),U=Object(_.a)(Object(r.a)(Object(S.default)({},c.q,(function(e,n){e.audioMuted=n.payload.muted})),{audioMuted:!1}),"chat.notifications"),x=t("JiVo"),D=t("uEoR"),$=t("SDKZ"),q=t("Cyw9"),L=t("Tpri"),T=t("sYZ1"),P=t("RYq1"),R=t("wBBB");function N(){var e;return(null===(e=Object(R.a)())||void 0===e?void 0:e.getUserId())||P.c}var B=Object(r.a)((E={},Object(S.default)(E,$.m,(function(e,n){var t=Object(D.a)(n.payload.args,3),s=t[1],a=t[2],i=void 0===a?{}:a,r=n.globalState;if(!Object(T.b)(r))return e;var o=Object(q.b)(e),d=Object(l.e)(r),c=i.botSkill,u=i.botSkillTab,g=void 0===u?"":u;if(e.botSkill=c,e.botSkillTab=g,s==="/chat/room/".concat(P.b)&&(o.botSkill!==c||o.botSkillTab!==g))switch(c){case"welcome":e.rawEvents=Q(r,d);break;case"identity":e.rawEvents=W(r,d);break;case"offlineAgents":var f=Y(r,d,g);e.rawEvents=f;break;case"unresponsiveAgents":var v=H(r,d);e.rawEvents=v}return e})),Object(S.default)(E,$.o,(function(e,n){var t=n.payload.data.chat,s=n.globalState;if(!Object(T.b)(s))return e;var a=Object(l.e)(s),r=function(e,n){return function(t){return Object(i.d)(t,e)===Object(i.d)(t,n)}}(a,t);return!a||Object(i.e)(a)?(e.chatSettings=t,e.rawEvents=[J(s)],e):(r("skills.welcome.welcomeMessage")||(e.rawEvents=Q(s,t)),r("skills.identity.requestMessage")&&r("skills.identity.invalidMessage")&&r("skills.identity.completionMessage")||(e.rawEvents=W(s,t)),r("skills.offlineAgents.newConversation.offlineMessage")&&r("skills.offlineAgents.newConversation.identity.enabled")&&r("skills.offlineAgents.newConversation.identity.requestMessage")&&r("skills.offlineAgents.newConversation.identity.invalidMessage")&&r("skills.offlineAgents.newConversation.identity.completionMessage")||(e.rawEvents=Y(s,t,"newConversation")),r("skills.offlineAgents.existingConversation.offlineMessage")&&r("skills.offlineAgents.existingConversation.onlineMessage")&&r("skills.offlineAgents.existingConversation.identity.enabled")&&r("skills.offlineAgents.existingConversation.identity.requestMessage")&&r("skills.offlineAgents.existingConversation.identity.invalidMessage")&&r("skills.offlineAgents.existingConversation.identity.completionMessage")||(e.rawEvents=Y(s,t,"existingConversation")),r("skills.unresponsiveAgents.standardMessage")||(e.rawEvents=H(s,t,"standard")),r("skills.unresponsiveAgents.identity.enabled")&&r("skills.unresponsiveAgents.identity.requestMessage")&&r("skills.unresponsiveAgents.identity.invalidMessage")&&r("skills.unresponsiveAgents.identity.completionMessage")||(e.rawEvents=H(s,t,"identity")),e.chatSettings=t,e)})),Object(S.default)(E,c.e,(function(e){return e.rawEvents.forEach((function(e){e.sender===P.c&&(e.sender=N())})),e})),E),{rawEvents:[],botSkill:null});function J(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"join",t=N();return{type:"m.room.member",room_id:P.b,event_id:"$membership",state_key:t,sender:t,content:{membership:n,displayname:"User"},origin_server_ts:Date.now()}}function X(e,n,t,s){var a=Object(l.h)(e),i=Object(L.c)(s,a);return{type:"m.room.message",room_id:P.b,sender:t,content:{msgtype:"m.notice",format:"org.matrix.custom.html",body:i,formatted_body:i},event_id:n,origin_server_ts:Date.now()}}function Z(){return{type:"m.room.power_levels",room_id:P.b,event_id:"$powerlevel",state_key:"",sender:P.a,origin_server_ts:Date.now(),content:{users:[],users_default:-1,events:{},events_default:-1,state_default:-1,ban:-1,kick:-1,redact:-1,invite:-1}}}function K(e,n,t){return X(e,n,P.a,t)}function Q(e,n){return[J(e),Z(),K(e,"$welcome.welcomeMessage",n.skills.welcome.welcomeMessage)]}function V(e){return e.skills.identity}function W(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V;return[J(e),Z(),K(e,"$identity.requestMessage",t(n).requestMessage),X(e,"$identity.invalidResponse",N(),"I don't want to give you my email"),K(e,"$identity.invalidMessage",t(n).invalidMessage),X(e,"$identity.validResponse",N(),"me@example.org"),K(e,"$identity.completionMessage",t(n).completionMessage)]}function Y(e,n,t){var s=[];return"newConversation"===t?s.push.apply(s,Object(x.a)(function(e,n){return[J(e),Z(),K(e,"$offlineAgents.newConversation.offlineMessage",n.skills.offlineAgents.newConversation.offlineMessage)]}(e,n))):s.push.apply(s,Object(x.a)(function(e,n){return[J(e),Z(),K(e,"$offlineAgents.existingConversation.offlineMessage",n.skills.offlineAgents.existingConversation.offlineMessage),K(e,"$offlineAgents.existingConversation.onlineMessage",n.skills.offlineAgents.existingConversation.onlineMessage)]}(e,n))),n.skills.offlineAgents[t].identity.enabled&&s.push.apply(s,Object(x.a)(W(e,n,function(e){return function(n){return n.skills.offlineAgents[e].identity}}(t)))),s}function H(e,n,t){var s=[J(e),Z(),X(e,"$unresponsiveAgents.enduserMessage",N(),"Hello, I need some help.")];switch(t){case"identity":s.push.apply(s,Object(x.a)(W(e,n,(function(e){return e.skills.unresponsiveAgents.identity}))));break;default:s.push(K(e,"$unresponsiveAgents.standardMessage",n.skills.unresponsiveAgents.standardMessage))}return s}n.a=Object(s.a)({rooms:y,users:M,agentIds:C,notifications:U,preview:B})}}]);